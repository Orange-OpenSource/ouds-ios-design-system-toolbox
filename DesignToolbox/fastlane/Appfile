#
# Software Name: OUDS iOS
# SPDX-FileCopyrightText: Copyright (c) Orange SA
# SPDX-License-Identifier: MIT
#
# This software is distributed under the MIT license,
# the text of which is available at https://opensource.org/license/MIT/
# or see the "LICENSE" file for more details.
#
# Authors: See CONTRIBUTORS.txt
# Software description: A SwiftUI components library with code examples for Orange Unified Design System
#

# About configuration:
#   OUDS_FASTLANE_APPLE_ID = Apple identifier user for Fastlane
#   OUDS_DEVELOPER_PORTAL_TEAM_ID = Apple team identifier of the acccount who created provisioning profiles and distribution certificates for OUDS iOS 
#   OUDS_DEVELOPER_BUNDLE_IDENTIFIER =  Bundle identifier of the demo app for OUDS iOS 
#   TESTFLIGHT_GROUPS = alpha-team, beta-team, public-access TestFlight teams 

# TODO The 3 teams need to be created in the TestFlight page of the app in App Store Connect

apple_id(ENV["OUDS_FASTLANE_APPLE_ID"])

# It seems there are troubles with authentication of the Apple account for Test Flight upload using this Fastlane upload_to_testflight lane.
# As a workaround, altool is used instead and make uploads needed to be then assigned to test teams.
# Thus until clean resolution this team ID are not used anymore.
# Still keep them a bit hoping things will be go back to normal soon.
# See https://github.com/Orange-OpenSource/ouds-ios/issues/1195
# See https://github.com/fastlane/fastlane/issues/29803
team_id(ENV["OUDS_DEVELOPER_PORTAL_TEAM_ID"])

for_lane :build_alpha do
  app_identifier(ENV["OUDS_DEVELOPER_BUNDLE_IDENTIFIER"])
  ENV["TESTFLIGHT_GROUPS"] = "alpha-team"
end

for_lane :build_beta do
  app_identifier(ENV["OUDS_DEVELOPER_BUNDLE_IDENTIFIER"])
  ENV["TESTFLIGHT_GROUPS"] = "beta-team"
end

for_lane :build_stable do
  app_identifier(ENV["OUDS_DEVELOPER_BUNDLE_IDENTIFIER"])
  ENV["TESTFLIGHT_GROUPS"] = "public-access"
end
